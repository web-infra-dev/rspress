---
tag: new
---

# @rspress/plugin-preview <SourceCode href="https://github.com/web-infra-dev/rspress/tree/main/packages/plugin-preview" />

import { SourceCode, PackageManagerTabs, Tabs, Tab } from '@theme';

Used to preview components in the code block of md(x) files, suitable for writing component library documentation.

## Installation

<PackageManagerTabs command="add @rspress/plugin-preview -D" />

## Usage

### 1. Install the plugin

First, write the following config in the config file:

```ts title="rspress.config.ts" twoslash
import { defineConfig } from '@rspress/core';
import { pluginPreview } from '@rspress/plugin-preview';

export default defineConfig({
  plugins: [pluginPreview()],
});
```

### 2. Use in mdx files

Use the ` ```tsx preview ` syntax in mdx files:

````mdx title="example.mdx"
```tsx preview
import { useState } from 'react';

function App() {
  const [count, setCount] = useState(0);

  return (
    <div style={{ textAlign: 'center' }}>
      <p>Current count: {count}</p>
      <button onClick={() => setCount(count + 1)}>+</button>
      <button onClick={() => setCount(count - 1)}>-</button>
    </div>
  );
}

export default App;
```
````

The rendering result is as follows:

```tsx preview
import { useState } from 'react';

function App() {
  const [count, setCount] = useState(0);

  return (
    <div style={{ textAlign: 'center' }}>
      <p>Current count: {count}</p>
      <button onClick={() => setCount(count + 1)}>+</button>
      <button onClick={() => setCount(count - 1)}>-</button>
    </div>
  );
}

export default App;
```

:::tip

1. Currently only works in `.mdx` files.
2. You need to export the component as default, and Rspress will automatically render this component.

:::

### 3. Write component code in other files

In addition to writing component code in the code block of the mdx file, you can also use it with [File Code Block](../../guide/use-mdx/code-blocks.mdx#file-code-block) to write the example code in other files.

````mdx title="example.mdx"
```tsx file="./_demo.tsx" preview

```
````

```tsx title="_demo.tsx" file="./_demo.tsx"

```

The rendering result is as follows:

```tsx file="./_demo.tsx" preview

```

## Using iframe preview mode \{#preview-mode}

This plugin has multiple built-in preview modes. By adjusting the `preview="..."` meta information, for example ` ```tsx preview="iframe-follow" `, you can switch between different preview modes. The [defaultPreviewMode](#defaultPreviewMode) configuration option can be used to configure the default preview mode.

:::tip

You can choose to use the preview mode with iframe for component display to isolate the runtime environment between the documentation and the component, avoiding issues like style conflicts, or choose a preview mode suitable for mobile component display.

:::

### `preview="internal"`

The default `"internal"` mode effect is as follows:

Syntax:

````mdx
```tsx file="./_demo.tsx" preview="internal"

```
````

Rendering result:

```tsx file="./_demo.tsx" preview="internal"

```

### `preview="iframe-follow"`

The `"iframe-follow"` mode effect is as follows:

Syntax:

````mdx
```tsx file="./_demo.tsx" preview="iframe-follow"

```
````

Rendering result:

```tsx file="./_demo.tsx" preview="iframe-follow"

```

### `preview="iframe-fixed"`

The `"iframe-fixed"` mode effect is as follows:

Syntax:

````mdx
```tsx file="./_demo.tsx" preview="iframe-fixed"

```
````

Rendering result:

![](https://lf3-static.bytednsdoc.com/obj/eden-cn/uhbfnupenuhf/rspress/demo-preview-mobile-fixed.png)

## Options

This plugin accepts an object parameter of the following type:

```ts
interface PreviewOptions {
  defaultRenderMode?: 'pure' | 'preview';
  defaultPreviewMode?: 'internal' | 'iframe-fixed' | 'iframe-follow';
  iframeOptions?: IframeOptions;
  previewLanguages?: string[];
  previewCodeTransform?: (codeInfo: {
    language: string;
    code: string;
  }) => string;
}

interface IframeOptions {
  framework?: 'react' | 'solid';
  devPort?: number;
  builderConfig?: RsbuildConfig;
}
```

### defaultRenderMode

- **Type:** `string`
- **Default:** `pure`

Supports configuring the default behavior of internal code blocks that do not actively declare `pure` or `preview`, defaults to `pure`.

- ` ```tsx pure`: Render as a regular code block.
- ` ```tsx `: Render based on the `defaultRenderMode` configuration.
- ` ```tsx preview`: Render as a preview component.

### defaultPreviewMode

- **Type:** `"internal" | "iframe-follow" | "iframe-fixed" `
- **Default:** `internal`

The `defaultPreviewMode` parameter is used to configure the [preview mode](#preview-mode) for ` ```tsx preview`, defaults to `"internal"`.

- ` ```tsx preview`: Render based on the `defaultPreviewMode` configuration.
- ` ```tsx preview="internal"`: Render using internal mode.
- ` ```tsx preview="iframe-follow"`: Render using follow mode.
- ` ```tsx preview="iframe-fixed"`: Render using fixed mode.

### iframeOptions

This plugin will start a new Rsbuild instance for the dev server and build artifacts of `iframe` mode code blocks, so the compilation process is completely isolated from Rspress documentation and can be configured independently.

#### iframeOptions.devPort

- **Type:** `number`
- **Default:** `7890`

When the default port conflicts, you can manually configure the dev server port for the component.

#### iframeOptions.builderConfig

Configure the build configuration for iframe, such as adding some global code logic.

#### iframeOptions.customEntry

Configure custom entry to support other `Web` frameworks, such as `Vue`.

customEntry can only be used when `preview="iframe-follow"` is set.

Here is an example using the Vue framework:

```ts
import { defineConfig } from '@rspress/core';
import { pluginPreview } from '@rspress/plugin-preview';
import { pluginVue } from '@rsbuild/plugin-vue';

export default defineConfig({
  // ...
  plugins: [
    pluginPreview({
      previewMode: 'iframe',
      previewLanguages: ['vue'],
      iframeOptions: {
        position: 'follow',
        customEntry: ({ entryCssPath, demoPath }) => {
          return `
          import { createApp } from 'vue';
          import App from ${JSON.stringify(demoPath)};
          import ${JSON.stringify(entryCssPath)};
          createApp(App).mount('#root');
          `;
        },
        builderConfig: {
          plugins: [pluginVue()],
        },
      },
    }),
  ],
});
```

### previewLanguages

- **Type:** `string[]`
- **Default:** `['jsx', 'tsx']`

The code languages that support preview, by default jsx and tsx codes are supported. If you need to support other formats of code, such as json/yaml, you can use it in conjunction with the `previewCodeTransform` configuration below.

### previewCodeTransform

- **Type:** `(codeInfo: { language: string; code: string }) => string`
- **Default:** `({ code }) => code`

Customize the transformation of the code before previewing. Taking JSON code as an example, if you want to render a piece of JSON Schema through custom transformation logic:

```json
{
  "type": "div",
  "children": "Render from JSON"
}
```

You can make the following configuration:

```ts
pluginPreview({
  // Note to add the default jsx and tsx
  previewLanguages: ['jsx', 'tsx', 'json'],
  previewCodeTransform(codeInfo) {
    if (codeInfo.language === 'json') {
      return `
import React from 'react';

const json = ${codeInfo.code};

export default function() {
return React.createElement(json.type, null, json.children);
}
`;
    } else {
      return codeInfo.code;
    }
  },
});
```

In this way, the component code after custom logic transformation will be rendered in the end.

## Migrating from V1

If you are migrating from Rspress V1, the plugin functionality itself has not changed, only the way of writing mdx source code will have the following adjustments:

- `<code src="./foo.tsx"/>` should be migrated to [File Code Block](../../guide/use-mdx/code-blocks.mdx#file-code-block) ` ```tsx file="./foo.tsx"`.

- The `defaultPreviewMode` configuration option replaces `iframeOptions.position` and `previewMode`.

:::tip Migration Examples

**Example 1**:

**Before**: You need to declare in both `rspress.config.ts` and mdx files.

```ts
pluginPreview({
  previewMode: 'iframe',
  iframeOptions: { position: 'fixed' },
});
```

````mdx
```tsx preview

```
````

**After**: You only need to declare in the mdx file.

````mdx
```tsx preview="iframe-fixed"

```
````

**Example 2**:

**Before**: Using the `iframe` or `previewMode="iframe"` attribute.

````mdx
```tsx iframe
// or

<code src="./_demo.tsx" previewMode="iframe" />
```
````

**After**: There is only one `preview="..."` attribute.

````mdx
```tsx preview="iframe-follow"

```

```tsx file="./_demo.tsx" preview="iframe-follow"

```
````

:::

- The default value of `defaultRenderMode` has changed from `preview` to `pure`.
